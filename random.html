<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		
		<script type="text/javascript" src="js/jquery-3.4.1.min.js"></script>
		<title></title>
	</head>
	<body>
		
		<div style="display: flex;justify-content: center;align-items: center;flex-direction: column;">
			<span>
				<button onclick="next()" style="padding: 20px;">下一张</button>
			</span>
			<img id="random_img" src="img/baidu_logo.png"/>
		</div>
		<script type="text/javascript">
			function getPromiseRequest(url) {
			            return new Promise(function (resolve, reject) {
			                var xhr = new XMLHttpRequest();
			               xhr.open('get', url);
			               xhr.send(null);
			                xhr.onreadystatechange = function () {
			                    if(xhr.readyState != 4) return;// 避免执行reject函数
			                    if (xhr.readyState == 4 && xhr.status == 200) {
			                        resolve(JSON.parse(xhr.response));
			                    } else{
			                        reject('找不到服务器');
			                    }
			                };
			                
			
			            })
			        }
					
			var isdata = true;		
			document.onreadystatechange = function() {
				if (document.readyState = "complete") {
					if(isdata){
						getPromiseRequest('http://localhost:8082/random/img')
						    .then(function (data) {
						      console.log(data.data.img);
						      isdata = false;
							  var imgUrl = data.data.img;
							 document.getElementById("random_img").src = imgUrl;
						    }, function (err) {
						        console.log(err);
						    }).then(function(data) {
						        console.log(data);
						    })
					}
					
				}
			};		
							
							function next(){
								getPromiseRequest('http://localhost:8082/random/img')
								    .then(function (data) {
								      console.log(data.data.img);
								      isdata = false;
									  var imgUrl = data.data.img;
									 document.getElementById("random_img").src = imgUrl;
								    }, function (err) {
								        console.log(err);
								    }).then(function(data) {
								        console.log(data);
								    })
							}
		</script>
	</body>
</html>